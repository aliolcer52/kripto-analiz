<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoFlow | Piyasa Akƒ±≈ü Analizi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.8);
            --bg-glass: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-gold: #f59e0b;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --gradient-green: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --gradient-red: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --shadow-glow-green: 0 0 20px rgba(16, 185, 129, 0.3);
            --shadow-glow-red: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Scrollbar gizleme */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        html {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 40%);
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: var(--gradient-gold);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .view-toggle {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .view-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .view-btn:hover {
            color: var(--text-primary);
        }

        .view-btn.active {
            background: var(--gradient-gold);
            color: #000;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .refresh-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            background: var(--bg-glass);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.2);
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            gap: 10px;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        .tab-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: var(--gradient-gold);
            border-color: transparent;
            color: #000;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        /* Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .stat-card.buy::before {
            background: var(--gradient-green);
        }

        .stat-card.sell::before {
            background: var(--gradient-red);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card.buy:hover {
            box-shadow: var(--shadow-lg), var(--shadow-glow-green);
        }

        .stat-card.sell:hover {
            box-shadow: var(--shadow-lg), var(--shadow-glow-red);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
        }

        .stat-value.buy {
            color: var(--accent-green);
        }

        .stat-value.sell {
            color: var(--accent-red);
        }

        /* Balance Bar */
        .balance-section {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .balance-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .balance-value {
            font-size: 3rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            margin-bottom: 25px;
        }

        .balance-bar-container {
            background: var(--bg-secondary);
            border-radius: 50px;
            height: 40px;
            position: relative;
            overflow: hidden;
            display: flex;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        .balance-bar-sell {
            background: var(--gradient-red);
            height: 100%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .balance-bar-buy {
            background: var(--gradient-green);
            height: 100%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .balance-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-primary);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            gap: 15px;
            white-space: nowrap;
        }

        .balance-percent-sell {
            color: var(--accent-red);
        }

        .balance-percent-buy {
            color: var(--accent-green);
        }

        /* Matrix Table */
        .matrix-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            margin-top: 30px;
        }

        .matrix-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .matrix-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .matrix-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
        }

        .matrix-table th {
            text-align: left;
            padding: 16px 24px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--bg-secondary);
        }

        .matrix-table th:first-child {
            border-radius: 0;
        }

        .matrix-table td {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .matrix-table tr:last-child td {
            border-bottom: none;
        }

        .matrix-table tr:hover {
            background: var(--bg-glass);
        }

        .coin-info {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
        }

        .coin-symbol {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .coin-volume {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .price-value {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .flow-bar-container {
            width: 100%;
            height: 28px;
            background: var(--bg-secondary);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .flow-bar {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .flow-bar.green {
            background: var(--gradient-green);
            color: white;
        }

        .flow-bar.red {
            background: var(--gradient-red);
            color: white;
        }

        .flow-net {
            font-size: 0.8rem;
            margin-top: 6px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .flow-net.green {
            color: var(--accent-green);
        }

        .flow-net.red {
            color: var(--accent-red);
        }

        /* Coins Grid */
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 40px 0 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .coins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .coin-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .coin-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-gold);
        }

        .coin-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .coin-name-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .coin-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-gold);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            color: #000;
        }

        .coin-details h3 {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .coin-details span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .coin-price {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .coin-volume {
            font-size: 0.8rem;
            color: var(--accent-gold);
            margin-bottom: 16px;
            font-weight: 600;
        }

        .mini-bar-container {
            width: 100%;
            height: 32px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 16px;
            position: relative;
        }

        .mini-bar {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            transition: width 0.6s ease;
        }

        .mini-bar.green {
            background: var(--gradient-green);
        }

        .mini-bar.red {
            background: var(--gradient-red);
        }

        .coin-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .coin-stat {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .coin-stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .coin-stat-value {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .coin-stat-value.buy {
            color: var(--accent-green);
        }

        .coin-stat-value.sell {
            color: var(--accent-red);
        }

        /* Update Time */
        .update-time {
            text-align: right;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 20px;
        }

        /* Loading */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loader-text {
            margin-top: 20px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Preview - No Phone Frame */
        body.mobile-preview {
            background: var(--bg-primary);
        }

        body.mobile-preview .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 15px;
        }

        body.mobile-preview #mobile-view {
            max-width: 480px;
            margin: 0 auto;
            background: var(--bg-primary);
            min-height: 100vh;
            overflow-x: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        body.mobile-preview #mobile-view::-webkit-scrollbar {
            display: none;
        }

        body.mobile-preview header {
            position: relative;
            top: 0;
        }

        body.mobile-preview .header-content {
            padding: 12px 15px;
        }

        body.mobile-preview .logo-icon {
            width: 30px;
            height: 30px;
        }

        body.mobile-preview .logo-text h1 {
            font-size: 1rem;
        }

        body.mobile-preview .tabs-container {
            padding: 10px 0;
        }

        body.mobile-preview .tab-btn {
            padding: 8px 14px;
            font-size: 0.8rem;
        }

        body.mobile-preview main {
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 10px 0;
        }

        body.mobile-preview main::-webkit-scrollbar {
            display: none;
        }

        body.mobile-preview .container {
            max-width: 375px;
            margin: 40px auto;
            background: transparent;
        }

        body.mobile-preview .phone-frame {
            display: block;
            position: relative;
            width: 414px;
            margin: 0 auto;
            background: #1a1a1a;
            border-radius: 50px;
            padding: 15px;
            box-shadow: 
                0 0 0 2px #333,
                0 0 0 5px #1a1a1a,
                0 20px 60px rgba(0,0,0,0.8);
        }

        body.mobile-preview .phone-notch {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: #1a1a1a;
            border-radius: 0 0 20px 20px;
            z-index: 1000;
        }

        body.mobile-preview .phone-screen {
            background: var(--bg-primary);
            border-radius: 40px;
            overflow: hidden;
            height: 812px;
            position: relative;
        }

        body.mobile-preview .phone-status-bar {
            height: 44px;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        body.mobile-preview .phone-status-time {
            color: var(--text-primary);
        }

        body.mobile-preview .phone-status-icons {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        body.mobile-preview .phone-status-icons span {
            font-size: 0.7rem;
        }

        body.mobile-preview .phone-home-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 134px;
            height: 5px;
            background: rgba(255,255,255,0.5);
            border-radius: 3px;
            z-index: 1000;
        }

        body.mobile-preview header {
            position: relative;
            top: 0;
        }

        body.mobile-preview .header-content {
            padding: 10px 15px;
        }

        body.mobile-preview .logo-icon {
            width: 30px;
            height: 30px;
            font-size: 16px;
        }

        body.mobile-preview .logo-text h1 {
            font-size: 1rem;
        }

        body.mobile-preview .tabs-container {
            padding: 10px;
            gap: 8px;
        }

        body.mobile-preview .tab-btn {
            padding: 8px 12px;
            font-size: 0.75rem;
        }

        body.mobile-preview main {
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 10px;
        }

        body.mobile-preview main::-webkit-scrollbar {
            display: none;
        }

        body.mobile-preview .stats-grid {
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        body.mobile-preview .stat-card {
            padding: 12px;
            border-radius: 12px;
        }

        body.mobile-preview .stat-label {
            font-size: 0.7rem;
            margin-bottom: 4px;
        }

        body.mobile-preview .stat-value {
            font-size: 1.2rem;
        }

        body.mobile-preview .balance-section {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        body.mobile-preview .balance-title {
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        body.mobile-preview .balance-value {
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        body.mobile-preview .balance-bar-container {
            height: 28px;
            border-radius: 14px;
        }

        body.mobile-preview .balance-center {
            font-size: 0.7rem;
            padding: 2px 6px;
        }

        body.mobile-preview .section-title {
            font-size: 0.9rem;
            margin: 20px 0 10px;
        }

        body.mobile-preview .coins-grid {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        body.mobile-preview .coin-card {
            padding: 12px;
            border-radius: 12px;
        }

        body.mobile-preview .coin-card-header {
            margin-bottom: 8px;
        }

        body.mobile-preview .coin-icon {
            width: 28px;
            height: 28px;
            font-size: 0.75rem;
        }

        body.mobile-preview .coin-details h3 {
            font-size: 0.85rem;
        }

        body.mobile-preview .coin-details span {
            font-size: 0.65rem;
        }

        body.mobile-preview .coin-price {
            font-size: 0.8rem;
        }

        body.mobile-preview .coin-volume {
            font-size: 0.7rem;
            margin-bottom: 8px;
        }

        body.mobile-preview .mini-bar-container {
            height: 20px;
            margin-bottom: 6px;
        }

        body.mobile-preview .mini-bar {
            font-size: 0.6rem;
        }

        body.mobile-preview .coin-card-header img {
            width: 24px !important;
            height: 24px !important;
        }

        body.mobile-preview .coin-stats {
            gap: 6px;
        }

        body.mobile-preview .coin-stat {
            padding: 6px;
            border-radius: 6px;
        }

        body.mobile-preview .coin-stat-label {
            font-size: 0.6rem;
            margin-bottom: 2px;
        }

        body.mobile-preview .coin-stat-value {
            font-size: 0.7rem;
        }

        body.mobile-preview .matrix-container {
            border-radius: 12px;
        }

        body.mobile-preview .matrix-header {
            padding: 12px 15px;
        }

        body.mobile-preview .matrix-title {
            font-size: 0.85rem;
        }

        body.mobile-preview .matrix-subtitle {
            font-size: 0.7rem;
        }

        body.mobile-preview .matrix-table th,
        body.mobile-preview .matrix-table td {
            padding: 4px 6px;
            font-size: 0.6rem;
        }

        body.mobile-preview .coin-info img {
            width: 20px !important;
            height: 20px !important;
        }

        body.mobile-preview .coin-symbol {
            font-size: 0.7rem;
        }

        body.mobile-preview .coin-volume {
            font-size: 0.55rem;
        }

        body.mobile-preview .price-value {
            font-size: 0.7rem;
        }

        body.mobile-preview .flow-bar-container {
            height: 16px;
        }

        body.mobile-preview .flow-bar {
            font-size: 0.55rem;
        }

        body.mobile-preview .flow-net {
            font-size: 0.55rem;
            margin-top: 2px;
        }

        body.mobile-preview .update-time {
            font-size: 0.65rem;
            margin-bottom: 8px;
        }

        body.mobile-preview .matrix-container {
            margin-top: 10px;
        }

        body.mobile-preview .matrix-header {
            padding: 8px 10px;
        }

        body.mobile-preview .matrix-title {
            font-size: 0.75rem;
        }

        body.mobile-preview .matrix-subtitle {
            font-size: 0.6rem;
        }

        body.mobile-preview .view-toggle,
        body.mobile-preview .refresh-btn {
            display: none;
        }

        body.mobile-preview .mobile-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .tabs-container {
                flex-wrap: wrap;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .coins-grid {
                grid-template-columns: 1fr;
            }

            .balance-value {
                font-size: 2rem;
            }

            .matrix-table th,
            .matrix-table td {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation"></div>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Veriler Y√ºkleniyor...</div>
    </div>

    <!-- Desktop View -->
    <div id="desktop-view">
        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">üìä</div>
                        <div class="logo-text">
                            <h1>CryptoFlow</h1>
                            <p>Piyasa Akƒ±≈ü Analizi</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <div class="view-toggle">
                            <button class="view-btn active" onclick="setViewMode('desktop')">üñ•Ô∏è Desktop</button>
                            <button class="view-btn" onclick="setViewMode('mobile')">üì± Mobile</button>
                        </div>
                        <button class="refresh-btn" onclick="refreshAll()">
                            <span>‚Üª</span> Yenile
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('matrix')">
                <span>üìà</span> Akƒ±≈ü Matrisi
            </button>
            <button class="tab-btn" onclick="switchTab('orderbook')">
                <span>üìö</span> Emir Defteri
            </button>
            <button class="tab-btn" onclick="switchTab('alerts')">
                <span>üîî</span> Anomali Alarmlarƒ±
            </button>
        </div>

        <!-- Tab 1: Matrix -->
        <div id="tab-matrix" class="tab-content active">
            <div class="matrix-container">
                <div class="matrix-header">
                    <div>
                    <div class="matrix-title">üìä Top 20 Coin Para Akƒ±≈üƒ±</div>
                    <div class="matrix-subtitle">Piyasa Deƒüerine G√∂re Sƒ±ralanmƒ±≈ü (CoinGecko)</div>
                    </div>
                </div>
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>Coin</th>
                            <th>Fiyat</th>
                            <th>15 Dakika</th>
                            <th>1 Saat</th>
                            <th>4 Saat</th>
                            <th>24 Saat</th>
                        </tr>
                    </thead>
                    <tbody id="matrixBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                Veriler y√ºkleniyor...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tab 2: Order Book -->
        <div id="tab-orderbook" class="tab-content">
            <div class="update-time" id="lastUpdate">Son G√ºncelleme: --</div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card buy">
                    <div class="stat-label">Toplam Alƒ±m Emirleri</div>
                    <div class="stat-value buy" id="totalBuy">--</div>
                </div>
                <div class="stat-card sell">
                    <div class="stat-label">Toplam Satƒ±m Emirleri</div>
                    <div class="stat-value sell" id="totalSell">--</div>
                </div>
            </div>

            <!-- Balance Bar -->
            <div class="balance-section">
                <div class="balance-title">Net Emir Dengesi</div>
                <div class="balance-value" id="netValue">--</div>
                <div class="balance-bar-container" id="balanceBar">
                    <div class="balance-bar-sell" id="sellBar"></div>
                    <div class="balance-bar-buy" id="buyBar"></div>
                    <div class="balance-center">
                        <span class="balance-percent-sell" id="sellPercent">--% Satƒ±m</span>
                        <span style="color: var(--text-secondary);">|</span>
                        <span class="balance-percent-buy" id="buyPercent">--% Alƒ±m</span>
                    </div>
                </div>
            </div>

            <!-- Coins Grid -->
                <div class="section-title">üî• Coin Bazlƒ± Emir Defteri (Piyasa Deƒüerine G√∂re)</div>
            <div class="coins-grid" id="coinsGrid">
                <!-- Coin cards will be inserted here -->
            </div>
        </div>

        <!-- Tab 3: Anomaly Alerts -->
        <div id="tab-alerts" class="tab-content">
            <div class="update-time" id="alertLastUpdate">Son Tarama: --</div>
            
            <!-- Alert Stats -->
            <div class="stats-grid">
                <div class="stat-card buy">
                    <div class="stat-label">üöÄ Fƒ±rsat Sinyalleri</div>
                    <div class="stat-value buy" id="opportunityCount">0</div>
                </div>
                <div class="stat-card sell">
                    <div class="stat-label">‚ö†Ô∏è Risk Uyarƒ±larƒ±</div>
                    <div class="stat-value sell" id="riskCount">0</div>
                </div>
            </div>

            <!-- Alert Settings -->
            <div class="balance-section">
                <div class="balance-title">üéØ Anomali Tespit Ayarlarƒ±</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">Hacim Artƒ±≈ü Oranƒ± (%)</label>
                        <input type="number" id="volumeThreshold" value="300" min="100" max="1000" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">Fiyat Deƒüi≈üimi (%)</label>
                        <input type="number" id="priceThreshold" value="5" min="1" max="20" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">Tarama Sƒ±klƒ±ƒüƒ± (sn)</label>
                        <input type="number" id="scanInterval" value="30" min="10" max="300" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary);">
                    </div>
                </div>
                <button onclick="startAnomalyScanning()" style="margin-top: 20px; padding: 12px 30px; background: var(--gradient-gold); border: none; border-radius: 12px; color: #000; font-weight: 700; cursor: pointer; transition: all 0.3s ease;">
                    üöÄ Taramayƒ± Ba≈ülat
                </button>
            </div>

            <!-- Alerts List -->
            <div class="section-title">üî• Ger√ßek Zamanlƒ± Anomali Sinyalleri</div>
            <div id="alertsList" style="display: grid; gap: 15px;">
                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    Tarama ba≈ülatƒ±ldƒ±ƒüƒ±nda burada anomali sinyalleri g√∂r√ºnecektir...
                </div>
            </div>
        </div>
    </main>
    </div>
    <!-- End Desktop View -->

    <!-- Mobile View - No Phone Frame -->
    <div id="mobile-view" style="display: none;">
        <!-- Mobile Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">üìä</div>
                        <div class="logo-text">
                            <h1>CryptoFlow</h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile Content -->
        <main class="container">
            <!-- Tabs -->
            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('matrix')">
                    <span>üìà</span> Akƒ±≈ü
                </button>
                <button class="tab-btn" onclick="switchTab('orderbook')">
                    <span>üìö</span> Emir
                </button>
                <button class="tab-btn" onclick="switchTab('alerts')">
                    <span>üîî</span> Anomali
                </button>
            </div>

            <!-- Mobile Tab Contents (cloned via JS) -->
            <div id="mobile-tab-contents">
                <!-- Content will be cloned here -->
            </div>
        </main>
        
        <!-- Mobile Toggle Buttons -->
        <div style="padding: 20px; text-align: center; border-top: 1px solid var(--border-color); margin-top: 20px;">
            <button class="view-btn" onclick="setViewMode('desktop')" style="margin-right: 10px;">üñ•Ô∏è Desktop G√∂r√ºn√ºm</button>
            <button class="refresh-btn" onclick="refreshAll()">
                <span>‚Üª</span> Yenile
            </button>
        </div>
    </div>

    <script>
        // Globals
        const EXCLUDED = ['USDT', 'USDC', 'FDUSD', 'TUSD', 'DAI', 'USDP', 'EUR', 'BUSD', 'WBTC'];
        const intervals = ['15m', '1h', '4h', '1d'];
        const TOP_COINS_COUNT = 20;
        const ORDERBOOK_COINS_COUNT = 25;
        const ORDERBOOK_DEPTH = 100;

        let topCoins = [];
        let coinListCache = null;
        let coinListCacheTime = 0;
        let orderbookInterval = null;
        let isOrderbookActive = false;
        let anomalyInterval = null;
        let isAnomalyActive = false;
        let lastScanData = {};
        let alertHistory = [];

        const moneyFmt = new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        const priceFmt = new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 4 });

        // Format large numbers
        function formatLargeNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return moneyFmt.format(num);
        }

        // Initialize
        async function init() {
            await loadMatrix();
            document.getElementById('loader').classList.add('hidden');
        }

        // View Mode Switching
        function setViewMode(mode) {
            const desktopView = document.getElementById('desktop-view');
            const mobileView = document.getElementById('mobile-view');
            const body = document.body;
            const viewBtns = document.querySelectorAll('.view-btn');
            const mobileContainer = document.getElementById('mobile-tab-contents');

            viewBtns.forEach(btn => btn.classList.remove('active'));

            if (mode === 'mobile') {
                body.classList.add('mobile-preview');
                desktopView.style.display = 'none';
                mobileView.style.display = 'block';
                viewBtns[1].classList.add('active');
                
                // Clone active tab content to mobile
                const activeDesktopTab = document.querySelector('.tab-content.active');
                if (activeDesktopTab) {
                    const activeTabName = activeDesktopTab.id.replace('tab-', '');
                    const mobileTab = activeDesktopTab.cloneNode(true);
                    mobileTab.id = `mobile-tab-${activeTabName}`;
                    mobileTab.classList.add('active');
                    
                    mobileContainer.innerHTML = '';
                    mobileContainer.appendChild(mobileTab);
                    
                    // Update mobile tab buttons
                    const mobileTabBtns = mobileView.querySelectorAll('.tab-btn');
                    mobileTabBtns.forEach(btn => btn.classList.remove('active'));
                    const activeMobileBtn = Array.from(mobileTabBtns).find(btn => 
                        btn.textContent.toLowerCase().includes(activeTabName.substring(0, 4))
                    );
                    if (activeMobileBtn) activeMobileBtn.classList.add('active');
                }
            } else {
                body.classList.remove('mobile-preview');
                desktopView.style.display = 'block';
                mobileView.style.display = 'none';
                viewBtns[0].classList.add('active');
            }
        }

        // Refresh All Data
        async function refreshAll() {
            const loader = document.getElementById('loader');
            loader.classList.remove('hidden');
            
            try {
                await loadMatrix();
                if (isOrderbookActive) {
                    await updateOrderbook();
                }
                if (isAnomalyActive) {
                    const volumeThreshold = parseInt(document.getElementById('volumeThreshold')?.value || 300);
                    const priceThreshold = parseInt(document.getElementById('priceThreshold')?.value || 5);
                    await scanForAnomalies(volumeThreshold, priceThreshold);
                }
            } catch (err) {
                console.error('Refresh error:', err);
            } finally {
                loader.classList.add('hidden');
            }
        }

        // Tab Switching
        function switchTab(tabName) {
            const isMobile = document.body.classList.contains('mobile-preview');
            
            if (isMobile) {
                // Mobile view tab switching
                const mobileContainer = document.getElementById('mobile-tab-contents');
                mobileContainer.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                mobileContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                event.target.classList.add('active');
                
                // Clone tab content to mobile
                const desktopTab = document.getElementById(`tab-${tabName}`);
                if (desktopTab) {
                    const mobileTab = desktopTab.cloneNode(true);
                    mobileTab.id = `mobile-tab-${tabName}`;
                    mobileTab.classList.add('active');
                    
                    // Clear previous contents and add new one
                    mobileContainer.innerHTML = '';
                    mobileContainer.appendChild(mobileTab);
                }
            } else {
                // Desktop view tab switching
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                event.target.classList.add('active');
                document.getElementById(`tab-${tabName}`).classList.add('active');
            }

            if (tabName === 'orderbook') {
                isOrderbookActive = true;
                isAnomalyActive = false;
                if (anomalyInterval) clearInterval(anomalyInterval);
                setTimeout(() => {
                    startOrderbookUpdates();
                }, 100);
            } else if (tabName === 'alerts') {
                isAnomalyActive = true;
                isOrderbookActive = false;
                if (orderbookInterval) clearInterval(orderbookInterval);
            } else {
                isOrderbookActive = false;
                isAnomalyActive = false;
                if (orderbookInterval) clearInterval(orderbookInterval);
                if (anomalyInterval) clearInterval(anomalyInterval);
            }
        }

        // Anomaly Detection Functions
        function startAnomalyScanning() {
            // Hem desktop hem mobile view'daki elementleri kontrol et
            const scanIntervalEl = document.getElementById('scanInterval') || 
                                 (document.querySelector('.mobile-preview') && document.querySelector('#mobile-tab-alerts #scanInterval'));
            const volumeThresholdEl = document.getElementById('volumeThreshold') || 
                                    (document.querySelector('.mobile-preview') && document.querySelector('#mobile-tab-alerts #volumeThreshold'));
            const priceThresholdEl = document.getElementById('priceThreshold') || 
                                   (document.querySelector('.mobile-preview') && document.querySelector('#mobile-tab-alerts #priceThreshold'));
            
            const interval = parseInt(scanIntervalEl?.value || 30) * 1000;
            const volumeThreshold = parseInt(volumeThresholdEl?.value || 300);
            const priceThreshold = parseInt(priceThresholdEl?.value || 5);
            
            isAnomalyActive = true;
            
            if (anomalyInterval) clearInterval(anomalyInterval);
            
            anomalyInterval = setInterval(() => {
                if (isAnomalyActive) {
                    scanForAnomalies(volumeThreshold, priceThreshold);
                }
            }, interval);
            
            // ƒ∞lk taramayƒ± hemen yap
            scanForAnomalies(volumeThreshold, priceThreshold);
            
            showNotification('üöÄ Anomeli taramasƒ± ba≈ülatƒ±ldƒ±!', 'success');
        }

        async function scanForAnomalies(volumeThreshold, priceThreshold) {
            try {
                // √ñnceki tarama verilerini temizle - hem desktop hem mobile i√ßin
                let alertsList = document.getElementById('alertsList');
                if (!alertsList && document.querySelector('.mobile-preview')) {
                    alertsList = document.querySelector('#mobile-tab-alerts #alertsList');
                }
                
                if (alertsList) {
                    alertsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">üîç Tarama yapƒ±lƒ±yor...</div>';
                }
                
                const coins = await getTopCoins(50);
                const anomalies = [];
                
                for (const coin of coins) {
                    const symbol = coin.symbol || (coin.baseAsset + 'USDT');
                    const [kline1d, kline1h, ticker, depth] = await Promise.all([
                        fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&limit=2`).then(r => r.json()),
                        fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=2`).then(r => r.json()),
                        fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}`).then(r => r.json()),
                        fetch(`https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=20`).then(r => r.json())
                    ]);
                    
                    const currentPrice = parseFloat(ticker.lastPrice);
                    const priceChange = parseFloat(ticker.priceChangePercent);
                    const volume24h = parseFloat(ticker.volume);
                    
                    // Hacim anomalisi kontrol√º
                    const volumeAnomaly = checkVolumeAnomaly(kline1d, volume24h, volumeThreshold);
                    
                    // Fiyat hareketi anomalisi
                    const priceAnomaly = Math.abs(priceChange) >= priceThreshold;
                    
                    // Emir defteri dengesizliƒüi
                    const orderImbalance = checkOrderImbalance(depth);
                    
                    // Anomali bulunduysa
                    if (volumeAnomaly || priceAnomaly || orderImbalance) {
                        const anomaly = {
                            symbol: coin.baseAsset || coin.symbol.replace('USDT', ''),
                            currentPrice,
                            priceChange,
                            volume24h,
                            volumeAnomaly,
                            priceAnomaly,
                            orderImbalance,
                            timestamp: new Date(),
                            type: determineAnomalyType(volumeAnomaly, priceAnomaly, orderImbalance, priceChange),
                            image: coin.image || ''
                        };
                        
                        anomalies.push(anomaly);
                    }
                }
                
                displayAnomalies(anomalies);
                updateAlertStats(anomalies);
                
                // Update timestamp for both views
                let alertLastUpdate = document.getElementById('alertLastUpdate');
                if (!alertLastUpdate && document.querySelector('.mobile-preview')) {
                    alertLastUpdate = document.querySelector('#mobile-tab-alerts #alertLastUpdate');
                }
                
                if (alertLastUpdate) {
                    alertLastUpdate.textContent = 'Son Tarama: ' + new Date().toLocaleTimeString('tr-TR');
                }
                
            } catch (err) {
                console.error('Anomaly scan error:', err);
            }
        }

        function checkVolumeAnomaly(klineData, currentVolume, threshold) {
            if (!klineData || klineData.length < 2) return false;
            
            const prevDayVolume = parseFloat(klineData[klineData.length - 2][5]); // Previous day's volume
            const avgVolume = prevDayVolume;
            
            if (avgVolume === 0) return false;
            
            const volumeIncrease = ((currentVolume - avgVolume) / avgVolume) * 100;
            return volumeIncrease >= threshold;
        }

        function checkOrderImbalance(depth) {
            if (!depth || !depth.bids || !depth.asks) return false;
            
            const bidTotal = depth.bids.slice(0, 10).reduce((sum, bid) => sum + parseFloat(bid[1]), 0);
            const askTotal = depth.asks.slice(0, 10).reduce((sum, ask) => sum + parseFloat(ask[1]), 0);
            
            const total = bidTotal + askTotal;
            const buyRatio = (bidTotal / total) * 100;
            
            // %70'ten fazla alƒ±m veya satƒ±m baskƒ±sƒ±
            return buyRatio >= 70 || buyRatio <= 30;
        }

        function determineAnomalyType(volumeAnomaly, priceAnomaly, orderImbalance, priceChange) {
            if (volumeAnomaly && priceChange > 0) return 'BULLISH_BREAKOUT';
            if (volumeAnomaly && priceChange < 0) return 'BEARISH_BREAKDOWN';
            if (orderImbalance && priceChange > 5) return 'ACCUMULATION';
            if (orderImbalance && priceChange < -5) return 'DISTRIBUTION';
            if (volumeAnomaly) return 'VOLUME_SPIKE';
            if (priceAnomaly) return 'PRICE_VOLATILITY';
            if (orderImbalance) return 'ORDER_IMBALANCE';
            return 'GENERAL_ANOMALY';
        }

        function displayAnomalies(anomalies) {
            // Hem desktop hem mobile view'daki alerts list'ini bul
            let alertsList = document.getElementById('alertsList');
            if (!alertsList && document.querySelector('.mobile-preview')) {
                alertsList = document.querySelector('#mobile-tab-alerts #alertsList');
            }
            
            if (!alertsList) return;
            
            // Her yeni taramada √∂nceki sonu√ßlarƒ± temizle
            alertsList.innerHTML = '';
            
            if (anomalies.length === 0) {
                alertsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        ‚ö° Anomali tespit edilmedi. Piyasa normal seyrinde...
                    </div>
                `;
                return;
            }
            
            alertsList.innerHTML = anomalies.map(anomaly => {
                const typeConfig = getAlertTypeConfig(anomaly.type);
                const timeAgo = getTimeAgo(anomaly.timestamp);
                
                return `
                    <div class="coin-card" style="border-left: 4px solid ${typeConfig.color}; animation: pulse 2s infinite;">
                        <div class="coin-card-header">
                            <div class="coin-name-section" style="display: flex; align-items: center; gap: 12px;">
                                ${anomaly.image ? `<img src="${anomaly.image}" alt="${anomaly.symbol}" style="width: 40px; height: 40px; border-radius: 50%;">` : `<div class="coin-icon">${anomaly.symbol[0]}</div>`}
                                <div class="coin-details">
                                    <h3>${anomaly.symbol}</h3>
                                    <span style="color: ${typeConfig.color}; font-weight: 600;">${typeConfig.label}</span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="coin-price">$${priceFmt.format(anomaly.currentPrice)}</div>
                                <div style="font-size: 0.8rem; color: ${anomaly.priceChange >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'};">
                                    ${anomaly.priceChange >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(anomaly.priceChange).toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin: 15px 0; font-size: 0.85rem; color: var(--text-secondary);">
                            <div>üìä 24s Hacim: ${formatLargeNumber(anomaly.volume24h)}</div>
                            <div>üïê ${timeAgo}</div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${anomaly.volumeAnomaly ? '<span style="background: rgba(245, 158, 11, 0.2); color: var(--accent-gold); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">üî• Hacim Anomalisi</span>' : ''}
                            ${anomaly.priceAnomaly ? '<span style="background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">üìà Fiyat Hareketi</span>' : ''}
                            ${anomaly.orderImbalance ? '<span style="background: rgba(16, 185, 129, 0.2); color: var(--accent-green); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem;">‚öñÔ∏è Emir Dengesizliƒüi</span>' : ''}
                        </div>
                        
                        <div style="margin-top: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 8px; font-size: 0.8rem;">
                            ${typeConfig.description}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add pulse animation
            if (!document.querySelector('#pulseAnimation')) {
                const style = document.createElement('style');
                style.id = 'pulseAnimation';
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.02); }
                        100% { transform: scale(1); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        function getAlertTypeConfig(type) {
            const configs = {
                'BULLISH_BREAKOUT': {
                    label: 'üöÄ Boƒüa Kƒ±rƒ±lmasƒ±',
                    color: 'var(--accent-green)',
                    description: 'Y√ºksek hacimle birlikte yukarƒ± y√∂nl√º sert hareket. Bu bir y√ºkseli≈ü trendinin ba≈ülangƒ±cƒ± olabilir.'
                },
                'BEARISH_BREAKDOWN': {
                    label: 'üìâ Ayƒ± √á√∂k√º≈ü√º',
                    color: 'var(--accent-red)',
                    description: 'Y√ºksek hacimle birlikte a≈üaƒüƒ± y√∂nl√º sert hareket. Dikkatli olunmasƒ± gereken bir sinyal.'
                },
                'ACCUMULATION': {
                    label: 'üì¶ Birikim Fazƒ±',
                    color: 'var(--accent-green)',
                    description: 'Alƒ±cƒ±lar tarafƒ±ndan yoƒüun ≈üekilde biriktiriliyor. Y√ºkseli≈ü potansiyeli y√ºksek.'
                },
                'DISTRIBUTION': {
                    label: 'üì§ Daƒüƒ±tƒ±m Fazƒ±',
                    color: 'var(--accent-red)',
                    description: 'Satƒ±cƒ±lar tarafƒ±ndan yoƒüun ≈üekilde daƒüƒ±tƒ±lƒ±yor. D√º≈ü√º≈ü riski var.'
                },
                'VOLUME_SPIKE': {
                    label: 'üî• Hacim Patlamasƒ±',
                    color: 'var(--accent-gold)',
                    description: 'Normalin √ßok √ºzerinde i≈ülem hacmi. √ñnemli bir fiyat hareketi habercisi olabilir.'
                },
                'PRICE_VOLATILITY': {
                    label: 'üìä Fiyat Volatilitesi',
                    color: 'var(--accent-blue)',
                    description: 'Fiyatta a≈üƒ±rƒ± hareketlilik. Hem fƒ±rsat hem de risk i√ßeriyor.'
                },
                'ORDER_IMBALANCE': {
                    label: '‚öñÔ∏è Emir Dengesizliƒüi',
                    color: 'var(--accent-green)',
                    description: 'Alƒ±m veya satƒ±m emirlerinde ciddi dengesizlik. Kƒ±sa vadeli hareket sinyali.'
                },
                'GENERAL_ANOMALY': {
                    label: '‚ö° Genel Anomali',
                    color: 'var(--accent-gold)',
                    description: 'Piyasa davranƒ±≈üƒ±nda anormalilik. ƒ∞zlenmesi gereken durum.'
                }
            };
            return configs[type] || configs['GENERAL_ANOMALY'];
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((new Date() - timestamp) / 1000);
            
            if (seconds < 60) return 'Az √∂nce';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' dakika √∂nce';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' saat √∂nce';
            return Math.floor(seconds / 86400) + ' g√ºn √∂nce';
        }

        function updateAlertStats(anomalies) {
            const opportunities = anomalies.filter(a => 
                a.type === 'BULLISH_BREAKOUT' || a.type === 'ACCUMULATION' || a.type === 'VOLUME_SPIKE'
            ).length;
            
            const risks = anomalies.filter(a => 
                a.type === 'BEARISH_BREAKDOWN' || a.type === 'DISTRIBUTION'
            ).length;
            
            // Update stats for both desktop and mobile views
            let opportunityCount = document.getElementById('opportunityCount');
            let riskCount = document.getElementById('riskCount');
            
            if (!opportunityCount && document.querySelector('.mobile-preview')) {
                opportunityCount = document.querySelector('#mobile-tab-alerts #opportunityCount');
                riskCount = document.querySelector('#mobile-tab-alerts #riskCount');
            }
            
            if (opportunityCount) opportunityCount.textContent = opportunities;
            if (riskCount) riskCount.textContent = risks;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? 'var(--gradient-green)' : 'var(--gradient-gold)'};
                color: #000;
                border-radius: 12px;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Market Cap Cache
        let marketCapCache = null;
        let marketCapCacheTime = 0;

        // Get Top Coins by Market Cap (using CoinGecko API)
        async function getTopCoinsByMarketCap(count = TOP_COINS_COUNT) {
            // 10 dakika cache
            if (marketCapCache && (Date.now() - marketCapCacheTime < 600000)) {
                return marketCapCache.slice(0, count);
            }
            
            try {
                // CoinGecko API - Market Cap'e g√∂re sƒ±ralanmƒ±≈ü coinler
                const res = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=${count + 10}&page=1&sparkline=false`);
                const data = await res.json();
                
                // Sadece Binance'da olan USDT √ßiftlerini filtrele
                const binanceRes = await fetch('https://api.binance.com/api/v3/exchangeInfo');
                const binanceData = await binanceRes.json();
                const binanceSymbols = new Set(binanceData.symbols.map(s => s.symbol));
                
                const validCoins = data.filter(coin => {
                    const symbol = coin.symbol.toUpperCase() + 'USDT';
                    return binanceSymbols.has(symbol) && !EXCLUDED.includes(coin.symbol.toUpperCase());
                }).map(coin => ({
                    symbol: coin.symbol.toUpperCase() + 'USDT',
                    baseAsset: coin.symbol.toUpperCase(),
                    marketCap: coin.market_cap,
                    current_price: coin.current_price,
                    total_volume: coin.total_volume,
                    price_change_24h: coin.price_change_percentage_24h,
                    image: coin.image
                }));
                
                marketCapCache = validCoins;
                marketCapCacheTime = Date.now();
                
                return validCoins.slice(0, count);
            } catch (err) {
                console.error('Market cap fetch error:', err);
                // Fallback to volume-based sorting
                return getTopCoinsByVolume(count);
            }
        }

        // Fallback: Get Top Coins by Volume
        async function getTopCoinsByVolume(count = TOP_COINS_COUNT) {
            if (coinListCache && (Date.now() - coinListCacheTime < 300000)) {
                return coinListCache.slice(0, count);
            }
            
            const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
            const data = await res.json();
            
            let pairs = data.filter(p => p.symbol.endsWith('USDT') && !EXCLUDED.some(x => p.symbol.startsWith(x)));
            pairs.sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume));
            
            coinListCache = pairs;
            coinListCacheTime = Date.now();
            
            return pairs.slice(0, count);
        }

        // Get Top Coins (wrapper function)
        async function getTopCoins(count = TOP_COINS_COUNT) {
            return getTopCoinsByMarketCap(count);
        }

        // Load Matrix
        async function loadMatrix() {
            const tbody = document.getElementById('matrixBody');
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">Y√ºkleniyor...</td></tr>';

            try {
                const coins = await getTopCoins();
                topCoins = coins;
                tbody.innerHTML = '';

                const promises = coins.map(coin => processCoinMatrix(coin));
                const results = await Promise.all(promises);
                
                results.forEach(data => renderMatrixRow(data, tbody));
            } catch (err) {
                console.error(err);
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--accent-red);">Veri y√ºklenirken hata olu≈ütu</td></tr>';
            }
        }

        async function processCoinMatrix(coin) {
            const symbol = coin.symbol || (coin.baseAsset + 'USDT');
            const requests = intervals.map(interval =>
                fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=1`)
                    .then(res => res.json())
                    .then(data => {
                        if (!data || !data.length) return { net: 0, buyPct: 50 };
                        const k = data[0];
                        const total = parseFloat(k[7]);
                        const buy = parseFloat(k[10]);
                        const net = buy - (total - buy);
                        return { net, buyPct: total > 0 ? (buy / total) * 100 : 50 };
                    })
            );

            const results = await Promise.all(requests);
            return {
                symbol: coin.baseAsset || coin.symbol.replace('USDT', ''),
                price: coin.current_price || coin.price || 0,
                marketCap: coin.marketCap || 0,
                volume: coin.total_volume || coin.volume || 0,
                image: coin.image || '',
                data: results
            };
        }

        function renderMatrixRow(coinData, tbody) {
            const tr = document.createElement('tr');
            const symbol = coinData.symbol || '';
            const marketCap = coinData.marketCap || 0;
            const price = coinData.price || 0;
            
            console.log('Rendering row:', { symbol, marketCap, price }); // Debug i√ßin
            
            const iconUrl = coinData.image || '';
            
            let html = `
                <td>
                    <div class="coin-info">
                        ${iconUrl ? `<img src="${iconUrl}" alt="${symbol}" style="width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0;">` : ''}
                        <div>
                            <div class="coin-symbol">${symbol}</div>
                            <div class="coin-volume">Piyasa Deƒüeri: $${formatLargeNumber(marketCap)}</div>
                        </div>
                    </div>
                </td>
                <td><div class="price-value">$${priceFmt.format(price)}</div></td>
            `;

            coinData.data.forEach(tf => {
                const isBuy = tf.buyPct >= 50;
                const pct = isBuy ? tf.buyPct : 100 - tf.buyPct;
                const sign = isBuy ? '+' : '-';
                
                html += `
                    <td>
                        <div class="flow-bar-container">
                            <div class="flow-bar ${isBuy ? 'green' : 'red'}" style="width: ${pct}%; margin-${isBuy ? 'right' : 'left'}: auto;">
                                ${pct.toFixed(0)}%
                            </div>
                        </div>
                        <div class="flow-net ${isBuy ? 'green' : 'red'}">${sign}$${moneyFmt.format(Math.abs(tf.net))}</div>
                    </td>
                `;
            });

            tr.innerHTML = html;
            tbody.appendChild(tr);
        }

        // Order Book Functions
        async function fetchOrderBook(symbol) {
            try {
                const res = await fetch(`https://api.binance.com/api/v3/depth?symbol=${symbol}&limit=${ORDERBOOK_DEPTH}`);
                const data = await res.json();
                
                if (!data || !data.bids || !data.asks) return { bids: 0, asks: 0 };

                const bidsTotal = data.bids.reduce((sum, bid) => {
                    return sum + (parseFloat(bid[0]) * parseFloat(bid[1]));
                }, 0);

                const asksTotal = data.asks.reduce((sum, ask) => {
                    return sum + (parseFloat(ask[0]) * parseFloat(ask[1]));
                }, 0);

                return { bids: bidsTotal, asks: asksTotal };
            } catch (err) {
                return { bids: 0, asks: 0 };
            }
        }

        async function startOrderbookUpdates() {
            await updateOrderbook();
            orderbookInterval = setInterval(() => {
                if (isOrderbookActive) updateOrderbook();
            }, 10000);
        }

        async function updateOrderbook() {
            try {
                const coins = await getTopCoins(ORDERBOOK_COINS_COUNT);
                const coinsData = [];

                for (const coin of coins) {
                    const ob = await fetchOrderBook(coin.symbol);
                    coinsData.push({
                        symbol: coin.baseAsset || coin.symbol.replace('USDT', ''),
                        price: coin.current_price || parseFloat(coin.lastPrice) || 0,
                        marketCap: coin.marketCap || 0,
                        volume: coin.total_volume || parseFloat(coin.quoteVolume) || 0,
                        image: coin.image || '',
                        bids: ob.bids,
                        asks: ob.asks
                    });
                }

                // Zaten market cap'e g√∂re sƒ±ralanmƒ±≈ü geliyor, tekrar sƒ±ralamaya gerek yok

                const totalBids = coinsData.reduce((sum, c) => sum + c.bids, 0);
                const totalAsks = coinsData.reduce((sum, c) => sum + c.asks, 0);
                const net = totalBids - totalAsks;
                const total = totalBids + totalAsks;
                const buyPct = total > 0 ? (totalBids / total) * 100 : 50;
                const sellPct = 100 - buyPct;

                // Update UI
                document.getElementById('totalBuy').textContent = '$' + formatLargeNumber(totalBids);
                document.getElementById('totalSell').textContent = '$' + formatLargeNumber(totalAsks);
                
                const netEl = document.getElementById('netValue');
                netEl.textContent = (net >= 0 ? '+' : '') + '$' + formatLargeNumber(Math.abs(net));
                netEl.style.color = net >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';

                document.getElementById('sellBar').style.width = sellPct + '%';
                document.getElementById('buyBar').style.width = buyPct + '%';
                document.getElementById('sellPercent').textContent = sellPct.toFixed(1) + '% Satƒ±m';
                document.getElementById('buyPercent').textContent = buyPct.toFixed(1) + '% Alƒ±m';

                document.getElementById('lastUpdate').textContent = 'Son G√ºncelleme: ' + new Date().toLocaleTimeString('tr-TR');

                renderCoinCards(coinsData);
            } catch (err) {
                console.error('Order book error:', err);
            }
        }

        function renderCoinCards(coinsData) {
            const grid = document.getElementById('coinsGrid');
            grid.innerHTML = '';

            coinsData.forEach((coin, index) => {
                const total = coin.bids + coin.asks;
                const buyPct = total > 0 ? (coin.bids / total) * 100 : 50;
                const sellPct = 100 - buyPct;
                const marketCap = coin.marketCap || 0;
                const price = coin.current_price || coin.price || 0;
                const iconUrl = coin.image || '';
                
                const card = document.createElement('div');
                card.className = 'coin-card';
                card.innerHTML = `
                    <div class="coin-card-header">
                        <div class="coin-name-section" style="display: flex; align-items: center; gap: 12px;">
                            ${iconUrl ? `<img src="${iconUrl}" alt="${coin.symbol}" style="width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0;">` : `<div class="coin-icon" style="flex-shrink: 0;">${coin.symbol[0]}</div>`}
                            <div class="coin-details">
                                <h3>${coin.symbol}</h3>
                                <span>#${index + 1} Market Cap</span>
                            </div>
                        </div>
                        <div class="coin-price">$${priceFmt.format(price)}</div>
                    </div>
                    <div class="coin-volume">Piyasa Deƒüeri: $${formatLargeNumber(marketCap)}</div>
                    
                    <!-- ƒ∞ki renkli bar -->
                    <div style="background: var(--bg-secondary); border-radius: 8px; height: 32px; display: flex; overflow: hidden; margin-bottom: 16px; position: relative; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);">
                        <div style="background: var(--gradient-red); height: 100%; width: ${sellPct}%; transition: width 0.5s ease; position: relative; display: flex; align-items: center; justify-content: center;">
                            <span style="color: #fff; font-weight: 700; font-size: 0.85rem; text-shadow: 0 1px 2px rgba(0,0,0,0.8);">${sellPct.toFixed(0)}%</span>
                        </div>
                        <div style="background: var(--gradient-green); height: 100%; width: ${buyPct}%; transition: width 0.5s ease; position: relative; display: flex; align-items: center; justify-content: center;">
                            <span style="color: #fff; font-weight: 700; font-size: 0.85rem; text-shadow: 0 1px 2px rgba(0,0,0,0.8);">${buyPct.toFixed(0)}%</span>
                        </div>
                    </div>
                    
                    <div class="coin-stats">
                        <div class="coin-stat">
                            <div class="coin-stat-label">Alƒ±m Emirleri</div>
                            <div class="coin-stat-value buy">$${formatLargeNumber(coin.bids)}</div>
                        </div>
                        <div class="coin-stat">
                            <div class="coin-stat-label">Satƒ±m Emirleri</div>
                            <div class="coin-stat-value sell">$${formatLargeNumber(coin.asks)}</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }



        // Init
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
